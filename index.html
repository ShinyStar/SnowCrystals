<!doctype html>
<head>
    <title>
        Snow Crystals
    </title>
</head>
<body style="background:#080932;text-align:center;color:white">
    <h1 style="text-shadow:0 0 3px white">Snow Crystal Generator</h1>
    Type: 
    <select id="type">
        <option value="stellar">Stellar</option>
        <option value="decorations">Decorations</option>
        <option value="dendrites" selected>Dendrites</option>
        <!--<option value="explode">Explode</option>-->
    </select>
    &ensp;Iterations: 
    <select id="iterations">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4" selected>4</option>
        <option value="5">5</option>
        <option value="6">6</option>
    </select>
    &ensp;<input type="checkbox" id="colored" checked>Colored</input>
    <br><br>
    <button id="generate" onClick="createCrystal(900, 900)" >Generate!</button>
    <br>
    <canvas id="canvas"></canvas>
    <script>
        var canvas=document.getElementById("canvas");
        canvas.width=1000;
        canvas.height=1000;

        function createCrystal(initialW, initialH){
            var ctx=document.getElementById("canvas").getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            var iterations=document.getElementById("iterations").value;

            if(document.getElementById("type").value=="stellar"){
                var x=500, y=500, w=initialW, h=initialH; //Pretty random start pos
                var sizes=[]; sizes.push({"w":w, "h":h});
                for(i=0;i<iterations;i++){
                    w=Math.floor(rand(w/3,w/2)); h=Math.floor(rand(h/3,h/2));
                    sizes.push({"w":w,"h":h});
                }
                stellar(x,y,sizes,0,iterations, "FFFFFF");
            }else if(document.getElementById("type").value=="decorations"){
                var x=500, y=500, w=initialW, h=initialH;
                var sizes=[]; sizes.push({"w":w, "h":h});
                for(i=0;i<iterations;i++){
                    w=Math.floor(rand(w/10,w/5)); h=Math.floor(rand(h/3,h/2)); //Up to h*2 for crazy stuff
                    sizes.push({"w":w,"h":h});
                }
                decorations(x,y,sizes,0,iterations, "FFFFFF", 0);
            }else if(document.getElementById("type").value=="dendrites"){
                var x=500, y=500, w=initialW, h=initialH;
                var sizes=[]; sizes.push({"w":w, "h":h});
                for(i=0;i<iterations;i++){
                    w=Math.floor(rand(w/5,w/3)); h=Math.floor(rand(h/3,h/2)); //Up to h*2 for crazy stuff
                    sizes.push({"w":w,"h":h});
                }
                dendrites(x,y,sizes,0,iterations, "FFFFFF", 0);
            }else if(document.getElementById("type").value=="explode"){
                var x=250, y=250, w=initialW, h=initialH;
                var sizes=[]; sizes.push({"w":w, "h":h});
                for(i=0;i<iterations;i++){
                    w=Math.floor(rand(w/3,w/2)); h=Math.floor(rand(h/3,h/2));
                    sizes.push({"w":w,"h":h});
                }
                explode(x,y,sizes,0,iterations, "FFFFFF", 0);
            }
        }

        //Stellar
        function stellar(x,y,sizes,i,iterations, color){
            if(i==iterations){return;}
            i++;
            var w=sizes[i].w; var h=sizes[i].h;
            drawHexagon(x,y,w, h, "#"+parseInt(color,16).toString(16));
            if(document.getElementById("colored").checked){
                var nextColor=(parseInt(color,16)-parseInt("101000",16)).toString(16)
            }else{
                var nextColor="FFFFFF";
            }
            //All 6 vertices
            stellar(x,y-h/2,sizes,i,iterations, nextColor);
            stellar(x+w/2,y-h/4,sizes,i,iterations, nextColor);
            stellar(x+w/2,y+h/4,sizes,i,iterations, nextColor);
            stellar(x,y+h/2,sizes,i,iterations, nextColor);
            stellar(x-w/2,y+h/4,sizes,i,iterations, nextColor);
            stellar(x-w/2,y-h/4,sizes,i,iterations, nextColor);
        }

        //Decorations (This is actually a buggy version of dendrites)
        function decorations(x,y,sizes,i,iterations, color, rotation){
            if(i==iterations){return;}
            i++;
            var c=document.getElementById("canvas");
            var ctx=c.getContext("2d");

            var w=sizes[i].w; var h=sizes[i].h;
            ctx.translate(x, y);
            ctx.rotate(rotation*Math.PI/180);
            ctx.translate(-x, -y); 
            drawHexagon(x,y,w,h, "#"+parseInt(color,16).toString(16));
            ctx.translate(x, y);
            ctx.rotate(-(rotation*Math.PI/180));
            ctx.translate(-x, -y);

            if(document.getElementById("colored").checked){
                var nextColor=(parseInt(color,16)-parseInt("101000",16)).toString(16)
            }else{
                var nextColor="FFFFFF";
            }
            decorations(x,y-h/2,sizes,i,iterations, nextColor, 0);
            decorations(x+w/2,y-h/4,sizes,i,iterations, nextColor, 60);
            decorations(x+w/2,y+h/4,sizes,i,iterations, nextColor, 120);
            decorations(x,y+h/2,sizes,i,iterations, nextColor, 180);
            decorations(x-w/2,y+h/4,sizes,i,iterations, nextColor, 240);
            decorations(x-w/2,y-h/4,sizes,i,iterations, nextColor, 300);
        }

        function dendrites(x,y,sizes,i,iterations, color, rotation){
            if(i==iterations){return;}
            i++;
            var c=document.getElementById("canvas");
            var ctx=c.getContext("2d");

            var w=sizes[i].w; var h=sizes[i].h;
            ctx.translate(x, y);
            ctx.rotate(rotation*Math.PI/180);
            ctx.translate(-x, -y); 
            drawHexagon(x,y,w,h, "#"+parseInt(color,16).toString(16));

            if(document.getElementById("colored").checked){
                var nextColor=(parseInt(color,16)-parseInt("101000",16)).toString(16)
            }else{
                var nextColor="FFFFFF";
            }
            dendrites(x,y-h/2,sizes,i,iterations, nextColor, 0);
            dendrites(x+w/2,y-h/4,sizes,i,iterations, nextColor, 60);
            dendrites(x+w/2,y+h/4,sizes,i,iterations, nextColor, 120);
            dendrites(x,y+h/2,sizes,i,iterations, nextColor, 180);
            dendrites(x-w/2,y+h/4,sizes,i,iterations, nextColor, 240);
            dendrites(x-w/2,y-h/4,sizes,i,iterations, nextColor, 300);

            ctx.translate(x, y);
            ctx.rotate(-(rotation*Math.PI/180));
            ctx.translate(-x, -y);
        }

        //Bug which causes explosions. It even makes anything that you try next fail
        //Sorry, it was funny, I had to leave it here. xD
        function explode(x,y,sizes,i,iterations, color, rotation){
            if(i==iterations){return;}
            i++;
            var c=document.getElementById("canvas");
            var ctx=c.getContext("2d");
            ctx.translate((c.width/2) - 50, (c.height/2) - 50);
            ctx.rotate(rotation);
            ctx.translate((-c.width/2) + 50, (-c.height/2) + 50); 
            var w=sizes[i].w; var h=sizes[i].h;
            drawHexagon(x,y,w, h, "#"+parseInt(color,16).toString(16));
            if(document.getElementById("colored").checked){
                var nextColor=(parseInt(color,16)-parseInt("101000",16)).toString(16)
            }else{
                var nextColor="FFFFFF";
            }
            explode(x,y-h/2,sizes,i,iterations, nextColor, 0);
            explode(x+w/2,y-h/4,sizes,i,iterations, nextColor, 60);
            explode(x+w/2,y+h/4,sizes,i,iterations, nextColor, 120);
            explode(x,y+h/2,sizes,i,iterations, nextColor, 180);
            explode(x-w/2,y+h/4,sizes,i,iterations, nextColor, 240);
            explode(x-w/2,y-h/4,sizes,i,iterations, nextColor, 300);
        }

        function drawHexagon(x, y, w, h, color){ //x and y are in the center
            var canvas=document.getElementById("canvas");
            var ctx=canvas.getContext("2d");

            ctx.fillStyle=color;
            ctx.beginPath();
            ctx.moveTo(x,y-h/2);
            ctx.lineTo(x+w/2,y-h/4);
            ctx.lineTo(x+w/2,y+h/4);
            ctx.lineTo(x,y+h/2);
            ctx.lineTo(x-w/2,y+h/4);
            ctx.lineTo(x-w/2,y-h/4);
            ctx.closePath();
            ctx.fill();
        }

        function rand(a, b) {
            return a + Math.floor(Math.random() * (b - a + 1));
        }
    </script>
</body>
